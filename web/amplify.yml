version: 1
frontend:
  phases:
    preBuild:
      commands:
        - yarn
    build:
      commands:
        - name: Get yarn cache directory path
          id: yarn-cache-dir-path
          run: echo "::set-output name=dir::$(yarn cache dir)"
        - uses: actions/cache@v3
          id: yarn-cache
          with:
            path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
            key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
            restore-keys: |
              ${{ runner.os }}-yarn-
        - name: Install
          run: yarn install
        - name: Lint
          run: yarn run lint
        - name: Test
          run: yarn run coverage
        - name: Send coverage report
          uses: codecov/codecov-action@v1
          with:
            flags: web
        - name: Check translations
          run: yarn i18n --fail-on-update
        - name: Build
          run: yarn build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
